---
alwaysApply: true
description: Supabaseコマンドの安全な使用に関するルール
---

# Supabaseコマンド安全使用ルール

## 絶対に実行してはいけないコマンド
以下のコマンドは、ユーザーが明示的に要求した場合のみ実行する：
- `npx supabase db reset --linked` - リモートデータベースのリセット（**絶対禁止**）
- `npx supabase db reset` - データベースのリセット（**確認必須**）
- `DROP TABLE` - テーブルの削除
- `DELETE FROM` - データの一括削除
- `TRUNCATE` - テーブルの内容を全削除

## 実行前に必ずユーザーの明示的な許可が必要なコマンド
- `npx supabase db reset --local` - ローカルデータベースのリセット
- `npx supabase db push` - マイグレーションのプッシュ
- `npx supabase db reset --linked` - リモートデータベースのリセット

## 安全に実行できるコマンド
- `npx supabase migration list` - マイグレーション一覧の確認
- `npx supabase db diff` - スキーマの差分確認
- `npx supabase status` - 現在の状態確認
- `npx supabase db reset --local` - ローカル環境のみ（要確認）

## データベース操作の代替手段
データベースの問題を確認する際は、以下の順序で代替手段を提案する：
1. **SQLクエリでの確認** - `SELECT`文を使用してデータやポリシーを確認
2. **ログの確認** - アプリケーションログやエラーログを確認
3. **マイグレーション状態の確認** - `npx supabase migration list`で状態を確認
4. **アプリケーション側でのデバッグ** - コードにログを追加してデバッグ
5. **最後の手段としてリセット** - ユーザーが明示的に要求した場合のみ

## 重要な注意事項
- **データベースリセットは既存のデータを完全に削除する**
- **デバッグや確認のためであっても、代替手段を提案する**
- **ユーザーが明示的に「リセットして」と言った場合のみ実行する**
- **リセット前に必ず「この操作でデータが削除されますが、よろしいですか？」と確認する**